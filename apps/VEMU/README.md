# VEMU: RISC-V RV32I 模拟器

## 项目概述

VEMU是一个RISC-V RV32I指令集模拟器，用于模拟和执行RISC-V基础整数指令集(RV32I)的程序。该模拟器参考了简单CPU实现，采用纯C语言编写，便于理解和扩展。
其指令集合使用表驱动模式 ,取值后解析指令, 然后遍历表 进入回调实现指令运行
## 架构设计

### 系统组件
- [x] **寄存器组**: 32个32位通用寄存器(x0~x31)，其中x0恒为0
  - 文件: `include/RV32I_registers.h`, `src/RV32I_registers.c`
- [x] **程序计数器(PC)**: 32位地址
  - 文件: `include/RV32I_registers.h`, `src/RV32I_registers.c`
- [x] **内存系统**: 支持字节寻址的内存空间
  - 文件: `include/RV32I_memory.h`, `src/RV32I_memory.c`
- [x] **指令解码器**: 解析不同指令格式
  - 文件: `include/RV32I_instruction.h`, `src/RV32I_opcodes.c`
- [x] **执行单元**: 执行各类指令
  - 文件: `src/RV32I_base_inst.c`
- [x] **控制逻辑**: 协调各组件工作
  - 文件: `src/RV32I_opcodes.c`

## 数据结构设计

### 指令表示
定义指令格式联合体，包含RV32I的六种指令格式：
- [x] **R型**: 寄存器-寄存器操作 (add, sub, sll等)
- [x] **I型**: 立即数操作 (addi, lw等)
- [x] **S型**: 存储操作 (sw, sh, sb)
- [x] **B型**: 分支操作 (beq, bne等)
- [x] **U型**: 上立即数 (lui, auipc)
- [x] **J型**: 跳转操作 (jal)

### CPU状态结构
- [x] 维护完整CPU状态，包括寄存器值、PC值、内存内容等

## 功能流程

### 指令周期
- [x] 1. **取指**: 从PC指向的内存位置读取指令
- [x] 2. **解码**: 分析指令类型及操作码
- [x] 3. **执行**: 根据指令类型执行相应操作
- [x] 4. **更新PC**: 顺序执行或跳转
- [x] 5. **重复周期**: 直到遇到停止条件

### 解码逻辑
- [x] 设计解码函数，提取指令中的关键字段：
  - [x] 操作码(opcode): 7位
  - [x] 功能码(funct3, funct7): 指定具体操作
  - [x] 寄存器字段(rd, rs1, rs2): 5位每个
  - [x] 立即数字段: 不同指令格式有不同编码方式

## 指令集实现概要

### 基本分类
- [x] **计算类指令**: 算术运算（已实现：add, sub, addi）
- [ ] **逻辑运算、移位指令**: 待完成
- [ ] **内存访问指令**: 加载/存储，支持不同数据宽度
- [ ] **控制流指令**: 条件分支、无条件跳转
- [ ] **系统指令**: 环境调用、断点等

### 特殊处理
- [x] 立即数的符号扩展
- [ ] 分支和跳转的目标地址计算
- [x] 内存对齐要求
- [ ] 处理器异常处理

## 调试与可视化

- [x] 寄存器状态输出（已实现 rv32i_print_reg）
- [x] 内存数据展示（已实现 rv32i_memory_print, 但需要增加输出到一个log目录中）
- [ ] 指令执行轨迹
- [ ] 断点设置与执行控制
- [ ] 增加log流处理, 将log整合

## 测试情况

- [x] 寄存器测试：验证读写操作、x0寄存器恒为0
- [x] 内存测试：验证初始化、释放、字节/半字/字读写操作、对齐检查
- [x] 指令测试：验证add、sub、addi指令的执行

## 实现计划

- [x] 1. 基础框架搭建
- [x] 2. 指令解码模块实现
- [ ] 3. 执行单元实现（部分完成）
- [x] 4. 内存系统实现
- [ ] 5. 调试工具开发（部分完成）
- [ ] 6. 完整测试用例验证
- [ ] 7. 更多指令实现
- [ ] 8. 性能优化

## 参考资料

- [RISC-V官方规范](https://riscv.org/technical/specifications/)
- [RISC-V指令集手册](https://github.com/riscv/riscv-isa-manual)